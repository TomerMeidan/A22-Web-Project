<!DOCTYPE html>
<html lang="en">
 <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Departments - Main</title>
    <!-- Include Tailwind CSS via CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
      /* Custom styles */
      .table-cell {
        @apply px-4 py-2;
      }
    </style>
 </head>
 <body class="bg-gray-100 font-sans leading-normal tracking-normal" onload="buildUsersTable()">
    <header class="flex justify-center items-center h-16 bg-blue-500 text-white">
      <h1 class="text-xl">Factory Management Site</h1>
    </header>
    <main class="container mx-auto px-4 py-8">
      <div class="flex flex-wrap justify-center">
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-2" onclick="location.href = '../index.html';">Homepage</button>
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-2" onclick="location.href = '../employees/employees.html';">Employees</button>
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-2" onclick="location.href = 'departments.html';">Departments</button>
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-2" onclick="location.href = '../shifts/shifts.html';">Shifts</button>
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-2" onclick="location.href = '../users/users.html';">Users</button>
        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded m-2" onclick="location.href = '../index.html';">Logout</button>
      </div>
      <div class="mt-8">
        <h3 class="text-lg font-semibold mb-4">Welcome, User</h3>
        <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4" onclick="location.href = './new-department';">
          Add New Department
        </button>
        <table class="w-full bg-white shadow-md rounded mt-6">
          <thead>
            <tr>
              <th class="table-cell">Department</th>
              <th class="table-cell">Manager</th>
              <th class="table-cell">Employees</th>
            </tr>
          </thead>
          <tbody id="users-table">
            <!-- Table rows will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
    </main>

    <script>
      function buildUsersTable() {
        let usersTable = document.getElementById("users-table");

        // Fake data
        const departmentsData = [
          {
            _id: '1',
            name: 'Engineering',
            manager: [{ firstName: 'John', lastName: 'Doe' }],
            employees: [
              { firstName: 'Jane', lastName: 'Smith' },
              { firstName: 'Bob', lastName: 'Johnson' },
            ],
          },
          {
            _id: '2',
            name: 'HR',
            manager: [{ firstName: 'Alice', lastName: 'Brown' }],
            employees: [
              { firstName: 'Charlie', lastName: 'Davis' },
              { firstName: 'Eve', lastName: 'Miller' },
            ],
          },
          // ... more departments
        ];

        departmentsData.forEach((department) => {
          if (department.name !== "NONE") {
            let row = usersTable.insertRow(-1);
            row.setAttribute("id", department._id);

            let departmentCell = row.insertCell(0);
            let managerCell = row.insertCell(1);
            let employeesCell = row.insertCell(2);

            departmentCell.addEventListener("click", () => {
              sessionStorage["editDepartmentID"] = department._id;
              location.href = "./edit-department";
            });

            departmentCell.innerHTML = `<a href="javascript: void(0)" class="text-blue-500 hover:underline">${department.name}</a>`;
            managerCell.innerHTML = `${department.manager[0].firstName} ${department.manager[0].lastName}`;

            department.employees.forEach((employee) => {
              const employeeLink = document.createElement("div");
              employeeLink.innerHTML = `<a href="javascript: void(0)" class="text-blue-500 hover:underline">${employee.firstName} ${employee.lastName}</a>`;
              employeeLink.setAttribute("id", employee._id);

              employeeLink.addEventListener("click", () => {
                sessionStorage["editEmployeeID"] = employee._id;
                location.href = "/employees/getPage/edit-employee";
              });

              employeesCell.appendChild(employeeLink);
            });
          }
        });
      }
    </script>
 </body>
</html>
